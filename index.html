<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>TROLLFACE SECURITY</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * { margin:0; padding:0; overflow:hidden; }
    body { background:#000; font-family: 'Courier New'; color: lime; }
    canvas { image-rendering: pixelated; }
    #boot, #login, #desktop, #kiosk, #game { position:absolute; top:0; left:0; width:100%; height:100%; display:none; }
    .btn { background:#000; color:lime; border:2px solid lime; padding:10px; margin:5px; cursor:pointer; }
    .window { background:#000; border:4px double lime; padding:20px; position:absolute; width:400px; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; }
    .cloud { position:absolute; filter: brightness(0.8); }
  </style>
</head>
<body>

<!-- BOOT SCREEN -->
<div id="boot">
  <img src="https://i.imgur.com/7g5mR8K.png" style="width:200px; margin:100px auto; display:block;">
  <audio id="ibmTune" src="https://cdn.freesound.org/previews/612/612551_5674468-lq.mp3" autoplay loop></audio>
</div>

<!-- LOGIN SCREEN -->
<div id="login" class="window">
  <h1>TROLLFACE SECURITY</h1>
  <img src="https://i.imgur.com/9n3x5fE.png" width="100"><br><br>
  <input type="text" id="username" placeholder="Username" class="btn"><br>
  <input type="password" id="password" placeholder="Password" class="btn"><br>
  <button onclick="login()" class="btn">LOGON</button>
  <audio id="trollTune" src="https://cdn.freesound.org/previews/612/612552_5674468-lq.mp3"></audio>
  <audio id="baldiTune" src="https://cdn.freesound.org/previews/612/612553_5674468-lq.mp3"></audio>
</div>

<!-- DESKTOP -->
<div id="desktop">
  <div style="position:absolute; top:10px; left:10px;">
    <button class="btn" onclick="showKiosk()">FLIGHT KIOSK</button>
    <button class="btn" onclick="uploadChar()">UPLOAD CHARACTER</button>
    <input type="file" id="charZip" accept=".zip" style="display:none">
    <button class="btn" onclick="testSecurity()">TEST SECURITY</button>
  </div>
  <canvas id="bonziCanvas" width="100" height="100" style="position:absolute; bottom:10px; right:10px; border:2px solid purple;"></canvas>
</div>

<!-- KIOSK -->
<div id="kiosk" class="window">
  <h2>SELECT FIGHTER</h2>
  <div id="charGrid"></div>
  <button onclick="startFight()" class="btn">FIGHT!</button>
</div>

<!-- GAME -->
<div id="game"></div>

<script>
  // === BOOT SEQUENCE ===
  setTimeout(() => {
    document.getElementById('boot').style.display = 'none';
    document.getElementById('login').style.display = 'block';
    document.getElementById('trollTune').play();
  }, 5000);

  // === LOGIN ===
  function login() {
    const user = document.getElementById('username').value;
    if (user) {
      document.getElementById('trollTune').pause();
      document.getElementById('baldiTune').play();
      setTimeout(() => {
        document.getElementById('login').style.display = 'none';
        document.getElementById('desktop').style.display = 'block';
        initBonzi();
      }, 2000);
    }
  }

  // === BONZI BUDDY ===
  function initBonzi() {
    const canvas = document.getElementById('bonziCanvas');
    const ctx = canvas.getContext('2d');
    let frame = 0;
    setInterval(() => {
      ctx.fillStyle = 'purple';
      ctx.fillRect(0, 0, 100, 100);
      ctx.fillStyle = 'white';
      ctx.font = '20px Arial';
      ctx.fillText(['Hello!', 'Upload a char!', 'Fight!'][frame % 3], 10, 50);
      frame++;
    }, 3000);
  }

  // === UPLOAD CHARACTER ===
  function uploadChar() {
    document.getElementById('charZip').click();
  }
  document.getElementById('charZip').addEventListener('change', async (e) => {
    const zip = e.target.files[0];
    const data = await JSZip.loadAsync(zip);
    const frames = [];
    for (let f in data.files) {
      if (f.endsWith('.png')) {
        const blob = await data.file(f).async('blob');
        const url = URL.createObjectURL(blob);
        frames.push(url);
      }
    }
    characters.push({ name: zip.name, frames, palette: [] });
    alert('Character uploaded!');
  });

  // === KIOSK ===
  let characters = [{ name: 'TITUS', frames: Array.from({length:585},(_,i)=>`assets/titus/bmframe_noesisdupname_${8243+i}.png`) }];
  function showKiosk() {
    document.getElementById('desktop').style.display = 'none';
    document.getElementById('kiosk').style.display = 'block';
    const grid = document.getElementById('charGrid');
    grid.innerHTML = '';
    characters.forEach((c, i) => {
      const div = document.createElement('div');
      div.className = 'btn';
      div.innerText = c.name;
      div.onclick = () => selectChar(i);
      grid.appendChild(div);
    });
  }
  let selectedChar = 0;
  function selectChar(i) { selectedChar = i; }

  // === FIGHT ENGINE ===
  function startFight() {
    document.getElementById('kiosk').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    startPhaserGame();
  }

  function startPhaserGame() {
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      parent: 'game',
      physics: { default: 'arcade' },
      scene: { preload, create, update }
    };
    new Phaser.Game(config);
  }

  function preload() {
    characters[selectedChar].frames.forEach((f,i) => this.load.image(`char_${i}`, f));
  }

  function create() {
    this.add.text(400, 50, 'TITUS vs GOON', { font: '32px Courier', color: '#0f0' }).setOrigin(0.5);

    // Sky
    const sky = this.add.graphics();
    const time = Math.random() * 4;
    const colors = time < 1 ? ['#87CEEB','#00008B'] : time < 2 ? ['#FF4500','#8B0000'] : time < 3 ? ['#FFD700','#FFA500'] : ['#4682B4','#191970'];
    sky.fillGradientStyle(...colors.map(c=>parseInt(c.slice(1),16)), 1,1,1,1);
    sky.fillRect(0,0,800,300);

    // Clouds
    for (let i = 0; i < 5; i++) {
      const cloud = this.add.image(Math.random()*800, Math.random()*200, 'char_0').setAlpha(0.5).setScale(2);
      cloud.dir = Math.random() < 0.5 ? -1 : 1;
      this.tweens.add({ targets: cloud, x: cloud.dir < 0 ? -200 : 1000, duration: 30000, repeat: -1 });
    }
  }

  // === ANTI-HACKER ===
  let tamperCount = 0;
  function testSecurity() {
    tamperCount = 0;
    alert('Security OK!');
  }
  window.addEventListener('keydown', e => {
    if (e.ctrlKey && e.shiftKey && e.key === 'I') {
      tamperCount++;
      if (tamperCount === 1) {
        alert('Detected potential threat! Enter master key:');
      } else if (tamperCount === 2) {
        madmanMode();
      }
    }
  });

  function madmanMode() {
    document.body.innerHTML = '<h1 style="color:red">DONâ€™T YOU DARE!</h1>'.repeat(100);
    const audio = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=');
    setInterval(() => audio.play(), 100);
  }
</script>
</body>
</html>